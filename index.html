<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Valentine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Patrick+Hand&family=Bangers&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Patrick Hand', cursive;
            overflow-x: hidden;
            background-color: #ffe4e6;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23ff0000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>') 12 12, auto;
        }

        /* Anime Speed Lines */
        .speed-lines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-radial-gradient(circle at center, transparent 0, transparent 10px, rgba(255,255,255,0.2) 11px, transparent 12px);
            opacity: 0;
            pointer-events: none;
            z-index: 0;
            transition: opacity 0.5s;
        }

        /* The Envelope */
        .envelope-container {
            perspective: 1000px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .envelope-container:hover {
            transform: scale(1.05);
        }
        .envelope {
            width: 300px;
            height: 200px;
            background: #ff5e78;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 110px solid #ff8fa3;
            transform-origin: top;
            transition: transform 0.6s ease-in-out, z-index 0.6s;
            z-index: 11;
        }
        .envelope.open .flap {
            transform: rotateX(180deg);
            z-index: 1;
        }
        .letter-content {
            position: absolute;
            bottom: 0;
            width: 90%;
            height: 80%;
            background: white;
            transition: transform 0.6s 0.2s ease-out;
            z-index: 5;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #d63384;
            transform: translateY(100%); /* Hidden initially */
            opacity: 0;
        }
        
        /* Modal Popup */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 50;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .popup-card {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            max-width: 90%;
            width: 450px;
            box-shadow: 0 0 50px rgba(255, 105, 180, 0.6);
            transform: scale(0.5);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            border: 4px solid #ff5e78;
            /* Changed to visible so YES button can expand outside the box */
            overflow: visible; 
        }

        /* Easter Egg: JoJo Menacing */
        .menacing {
            position: absolute;
            font-family: 'Bangers', cursive;
            color: #800080;
            font-size: 2rem;
            pointer-events: none;
            animation: floatUp 2s ease-out forwards;
            z-index: 60;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }

        /* Cat Spirit - Made Bigger and Clearer */
        .cat-spirit {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 150px; 
            height: 130px; 
            z-index: 40;
        }
        .cat-head {
            width: 100%;
            height: 100%;
            background: #2d2d2d;
            border-radius: 50% 50% 40% 40%;
            position: relative;
        }
        .cat-ear {
            position: absolute;
            top: -25px; 
            width: 50px; 
            height: 60px; 
            background: #2d2d2d;
            border-radius: 50% 50% 0 0;
        }
        .cat-ear.left { left: 10px; transform: rotate(-20deg); }
        .cat-ear.right { right: 10px; transform: rotate(20deg); }
        .cat-eye {
            position: absolute;
            top: 45px; 
            width: 40px; 
            height: 40px; 
            background: #ffeb3b;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(255, 235, 59, 0.5); /* Glow */
        }
        .cat-eye.left { left: 25px; }
        .cat-eye.right { right: 25px; }
        .cat-pupil {
            width: 12px; 
            height: 30px; 
            background: black;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            transition: transform 0.1s;
        }

        /* Dexter Easter Egg: Blood Slide styling */
        .blood-text {
            color: #8b0000;
            font-family: 'Bangers', cursive;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
            display: none;
        }

        /* Buttons */
        .btn-yes {
            background: #4ade80;
            color: white;
            font-family: 'Fredoka One', cursive;
            box-shadow: 0 4px 0 #16a34a;
            z-index: 10; 
            transform-origin: bottom center; /* Important: Expands UPWARDS */
        }
        .btn-yes:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-no {
            background: #ef4444;
            color: white;
            font-family: 'Fredoka One', cursive;
            box-shadow: 0 4px 0 #b91c1c;
            position: relative;
        }

        .alpaca-img {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 50%;
            border: 5px solid #ff8fa3;
            margin: 0 auto 1rem auto;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Confetti Canvas */
        #confetti {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        /* Hidden Video Players */
        .hidden-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
            z-index: -999;
        }
    </style>
</head>
<body class="h-screen flex items-center justify-center relative overflow-hidden">

    <!-- Anime Speed Lines BG -->
    <div class="speed-lines" id="speedLines"></div>

    <!-- Hidden Videos -->
    <video id="video1" class="hidden-video" loop>
        <source src="part1.mp4" type="video/mp4">
    </video>
    <video id="video2" class="hidden-video">
        <source src="part2.mp4" type="video/mp4">
    </video>

    <!-- 1. The Cat Spirit (Follows Mouse) -->
    <div class="cat-spirit" id="catSpirit">
        <div class="cat-ear left"></div>
        <div class="cat-ear right"></div>
        <div class="cat-head">
            <div class="cat-eye left"><div class="cat-pupil"></div></div>
            <div class="cat-eye right"><div class="cat-pupil"></div></div>
        </div>
    </div>

    <!-- 2. The Interactive Letter -->
    <div class="envelope-container" id="envelopeContainer" onclick="openLetter()">
        <div class="envelope" id="envelope">
            <div class="flap"></div>
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-20">
                <span class="text-white font-bold text-2xl drop-shadow-md">Click to Open</span>
            </div>
            <!-- Subtext Updated -->
            <div class="absolute bottom-2 right-2 text-white text-xs opacity-50">To: My Tiramisu</div>
        </div>
    </div>

    <!-- 3. The Popup Modal -->
    <div class="popup-overlay" id="popup">
        <div class="popup-card relative">
            <!-- Decorative Elements -->
            <div class="absolute top-2 left-2 text-2xl opacity-20">ü©∏</div> <!-- Dexter Vibe -->
            <div class="absolute top-2 right-2 text-2xl opacity-20">üëí</div> <!-- One Piece -->

            <!-- The Alpaca -->
            <img src="lily.png" alt="Cute Alpaca" class="alpaca-img" onerror="this.src='https://media.tenor.com/tI2F5rTqXyMAAAAi/llama-chew.gif'">
            
            <h2 class="text-3xl text-pink-600 font-bold mb-4 font-['Fredoka_One']">
                Mommy, will you be <br>
                <span class="text-red-500">dada's valentine?</span>
            </h2>

            <!-- Buttons -->
            <div class="flex justify-center gap-6 mt-6" style="min-height: 80px; align-items: center;">
                <button class="btn-yes px-8 py-3 text-xl rounded-full transition-all duration-300" id="btnYes" onclick="acceptLove()">YES!</button>
                <button class="btn-no px-8 py-3 text-xl rounded-full transition-all duration-300" id="btnNo" onmouseover="runAway()" onclick="dexterWarning()">NO</button>
            </div>

            <!-- Hidden Message Area (This should now stay visible longer) -->
            <div id="messageArea" class="mt-4 h-6 text-sm text-gray-400 italic"></div>
        </div>
    </div>

    <canvas id="confetti"></canvas>

    <script>
        // --- Video Elements ---
        const video1 = document.getElementById('video1');
        const video2 = document.getElementById('video2');

        // --- 1. Cat Eye Tracking Logic ---
        const catContainer = document.getElementById('catSpirit');
        const pupils = document.querySelectorAll('.cat-pupil');
        
        document.addEventListener('mousemove', (e) => {
            const rect = catContainer.getBoundingClientRect();
            const catX = rect.left + rect.width / 2;
            const catY = rect.top + rect.height / 2;
            
            const angle = Math.atan2(e.clientY - catY, e.clientX - catX);
            const distance = Math.min(10, Math.hypot(e.clientX - catX, e.clientY - catY) / 10); // Increased tracking range
            
            pupils.forEach(pupil => {
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                pupil.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px)`;
            });
        });

        // --- 2. Envelope Opening Logic ---
        function openLetter() {
            const envelope = document.getElementById('envelope');
            const container = document.getElementById('envelopeContainer');
            const popup = document.getElementById('popup');
            const lines = document.getElementById('speedLines');

            // Play Video 1 (Looping background audio/video)
            video1.play().catch(e => console.log("Interaction needed for playback"));

            // 1. Open Envelope Animation
            envelope.classList.add('open');
            
            // 2. JoJo Effect (Visual)
            createMenacingEffect(container.getBoundingClientRect());

            // 3. Transition to Modal
            setTimeout(() => {
                container.style.opacity = '0';
                lines.style.opacity = '1'; // Show speed lines
                
                popup.style.display = 'flex';
                // Trigger reflow
                void popup.offsetWidth; 
                popup.style.opacity = '1';
                document.querySelector('.popup-card').style.transform = 'scale(1)';
            }, 800);
        }

        function createMenacingEffect(rect) {
            const symbols = ['„Ç¥', '„Ç¥', '„Ç¥', 'MENACING'];
            for(let i=0; i<6; i++) {
                const el = document.createElement('div');
                el.innerText = symbols[Math.floor(Math.random() * symbols.length)];
                el.className = 'menacing';
                el.style.left = (rect.left + Math.random() * 200 - 50) + 'px';
                el.style.top = (rect.top + Math.random() * 100) + 'px';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 2000);
            }
        }

        // --- 3. The Runaway "No" Button (Dexter/Anime Chaos) ---
        const btnNo = document.getElementById('btnNo');
        const btnYes = document.getElementById('btnYes');
        
        let yesScale = 1;
        let noScale = 1;

        const messages = [
            "Yare yare daze.",
            "Hope is kind of like dominos: once one falls, the rest follow.",
            "Normal people are so weird,",
            "‚ÄúMiracles only happen to those who never give up.‚Äù",
            "MWHAHAHAHA",
            "MUDA MUDA MUDA"
        ];

        function runAway() {
            const card = document.querySelector('.popup-card');
            const cardRect = card.getBoundingClientRect();
            
            // Calculate new random position within the card for No Button
            const maxX = cardRect.width - btnNo.offsetWidth - 40; 
            const maxY = cardRect.height - btnNo.offsetHeight - 40;
            
            // Ensure positive values
            const safeX = Math.max(0, maxX);
            const safeY = Math.max(0, maxY);

            const randomX = Math.random() * safeX + 20; 
            const randomY = Math.random() * safeY + 20;

            // Update Sizes (SLOWER GROWTH for Yes)
            yesScale += 0.4; 
            noScale -= 0.10;
            if(noScale < 0) noScale = 0;

            // Apply transformations
            btnYes.style.transform = `scale(${yesScale})`;
            btnNo.style.transform = `scale(${noScale})`;
            
            // Apply absolute positioning relative to card content to make it run around
            btnNo.style.position = 'absolute';
            btnNo.style.zIndex = '100'; // Keep on top
            btnNo.style.left = `${randomX}px`;
            btnNo.style.top = `${randomY}px`;
            
            // Show random quote
            const msg = messages[Math.floor(Math.random() * messages.length)];
            const msgArea = document.getElementById('messageArea');
            msgArea.innerText = msg;
            msgArea.style.color = Math.random() > 0.5 ? '#8b0000' : '#d63384'; 
        }

        function dexterWarning() {
            alert("Dexter Morgan Disapproves. Try the Green button.");
        }

        // --- 4. The "Yes" Logic ---
        function acceptLove() {
            const popupCard = document.querySelector('.popup-card');

            // STOP Video 1, PLAY Video 2
            video1.pause();
            video1.currentTime = 0;
            video2.play();
            
            // Clear buttons and Update Message
            popupCard.innerHTML = `
                <h1 class="text-3xl font-bold text-pink-600 mb-2">I knew you'd say yes üòÅ</h1>
                <h2 class="text-2xl font-bold text-pink-500 mb-4">See you soon, my queen!</h2>
                <p class="text-xl">Forever your valentine ‚ù§Ô∏è</p>
                <div class="text-6xl mt-6 animate-bounce">ü•ù</div>
            `;
            
            // Confetti Explosion
            startConfetti();
            
            // Background Change
            document.body.style.backgroundColor = "#ffc1cc";
        }

        // --- Confetti Utility (Simple Version) ---
        function startConfetti() {
            const canvas = document.getElementById('confetti');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const pieces = [];
            for(let i=0; i<150; i++) {
                pieces.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    size: Math.random() * 10 + 5,
                    speed: Math.random() * 5 + 2
                });
            }

            function draw() {
                ctx.clearRect(0,0, canvas.width, canvas.height);
                pieces.forEach(p => {
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                    p.y += p.speed;
                    if(p.y > canvas.height) p.y = -20;
                });
                requestAnimationFrame(draw);
            }
            draw();
        }
    </script>
</body>
</html>